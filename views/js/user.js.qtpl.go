// Code generated by qtc from "user.js.qtpl". DO NOT EDIT.
// See https://github.com/valyala/quicktemplate for details.

//line user.js.qtpl:1
package js

//line user.js.qtpl:1
import (
	qtio422016 "io"

	qt422016 "github.com/valyala/quicktemplate"
)

//line user.js.qtpl:1
var (
	_ = qtio422016.Copy
	_ = qt422016.AcquireByteBuffer
)

//line user.js.qtpl:1
func StreamUserJS(qw422016 *qt422016.Writer) {
//line user.js.qtpl:1
	qw422016.N().S(`
	`)
//line user.js.qtpl:2
	qw422016.N().S(`/*
 * Copyright (c) 2023. Author: Ruslan Bikchentaev. All rights reserved.
 * Use of this source code is governed by a BSD-style
 * license that can be found in the LICENSE file.
 * Перший приватний програміст.
 */
var token = '';
var lang = 'en'
var userStruct;
var urlAfterLogin = '';

function getUser() {
    let user = localStorage.getItem("USER");
    if (user > '') {
        userStruct = JSON.parse(user);
        saveUser(userStruct);
    }
}

// handling response login form, save users data & render some properties
function afterLogin(userStruct, thisForm) {
    if (!userStruct) {
        alert("Need users data!");
        console.log(thisForm)
        return false;
    }

    localStorage.setItem("USER", JSON.stringify(userStruct));
    saveUser(userStruct);
    $('input[autofocus]:last').focus();

    return true;
}

function changeLang(newLang) {
    if (lang === newLang) {
        return false
    }

    lang = newLang;
    $.ajaxSetup({
        'headers': {'Authorization': 'Bearer ' + token, "Accept-Language": newLang}
    });
    $('.topline-navbar').load('/top_menu');
    $('.footer-mnu').load('/foot_menu');
    loadContent(document.location.href.replace(/lang=\d+/, `)
//line user.js.qtpl:2
	qw422016.N().S("`")
//line user.js.qtpl:2
	qw422016.N().S(``)
//line user.js.qtpl:2
	qw422016.N().S("`")
//line user.js.qtpl:2
	qw422016.N().S(`));
    return false
}


function saveUser(userStruct) {
    var userSuffix = userStruct.lang ? `)
//line user.js.qtpl:2
	qw422016.N().S("`")
//line user.js.qtpl:2
	qw422016.N().S(`(${userStruct.lang})`)
//line user.js.qtpl:2
	qw422016.N().S("`")
//line user.js.qtpl:2
	qw422016.N().S(` : '';
    console.log(userStruct);
    document.getElementById('bLogin').textContent = userStruct.name + userSuffix;
    token = userStruct.token || userStruct.access_token || userStruct.bearer_token || userStruct.auth_token;

    $('#bLogin').text(userStruct.name + userSuffix);
    $('.auth').removeClass("auth");
    changeLang(userStruct.lang);

    if (ChangeTheme !== undefined) {
        ChangeTheme(userStruct.theme);
    }

    if (urlAfterLogin === '') {
        if (userStruct.formActions !== undefined) {
            urlAfterLogin = userStruct.formActions[0].url;
        } else if (urlAfterLogin.onsubmit !== undefined) {
            urlAfterLogin.onsubmit();
            urlAfterLogin = "";
            return;
        }
    }
    if (urlAfterLogin > '') {
        loadContent(urlAfterLogin);
    }
}
`)
//line user.js.qtpl:2
	qw422016.N().S(`
`)
//line user.js.qtpl:3
}

//line user.js.qtpl:3
func WriteUserJS(qq422016 qtio422016.Writer) {
//line user.js.qtpl:3
	qw422016 := qt422016.AcquireWriter(qq422016)
//line user.js.qtpl:3
	StreamUserJS(qw422016)
//line user.js.qtpl:3
	qt422016.ReleaseWriter(qw422016)
//line user.js.qtpl:3
}

//line user.js.qtpl:3
func UserJS() string {
//line user.js.qtpl:3
	qb422016 := qt422016.AcquireByteBuffer()
//line user.js.qtpl:3
	WriteUserJS(qb422016)
//line user.js.qtpl:3
	qs422016 := string(qb422016.B)
//line user.js.qtpl:3
	qt422016.ReleaseByteBuffer(qb422016)
//line user.js.qtpl:3
	return qs422016
//line user.js.qtpl:3
}
