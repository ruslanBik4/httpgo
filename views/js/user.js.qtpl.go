// Code generated by qtc from "user.js.qtpl". DO NOT EDIT.
// See https://github.com/valyala/quicktemplate for details.

//line user.js.qtpl:1
package js

//line user.js.qtpl:1
import (
	qtio422016 "io"

	qt422016 "github.com/valyala/quicktemplate"
)

//line user.js.qtpl:1
var (
	_ = qtio422016.Copy
	_ = qt422016.AcquireByteBuffer
)

//line user.js.qtpl:1
func StreamUserJS(qw422016 *qt422016.Writer) {
//line user.js.qtpl:1
	qw422016.N().S(`
	`)
//line user.js.qtpl:2
	qw422016.N().S(`/*
 * Copyright (c) 2023. Author: Ruslan Bikchentaev. All rights reserved.
 * Use of this source code is governed by a BSD-style
 * license that can be found in the LICENSE file.
 * Перший приватний програміст. 
 */
"use strict";

var token = '';
var lang = 'en'
var userStruct = getUser();
var urlAfterLogin = '';

function getUser() {
    let user = localStorage.getItem("USER");
    if (user > '') {
        let userData = JSON.parse(user);
        saveUser(userData);
        console.log(userData)
        return userData;
    }
}

// handling response login form, save users data & render some properties
function afterLogin(userData, thisForm) {
    if (!userData) {
        alert("Need users data!");
        console.log(thisForm)
        return false;
    }

    localStorage.setItem("USER", JSON.stringify(userData));
    saveUser(userData);
    userStruct = userData;
    $('input[autofocus]:last').focus();

    return true;
}

function changeLang(newLang) {
    if (lang === newLang) {
        return false
    }

    lang = newLang;
    $.ajaxSetup({
        'headers': {'Authorization': 'Bearer ' + token, "Accept-Language": newLang}
    });
    $('.topline-navbar').load('/top_menu');
    $('.footer-mnu').load('/foot_menu');
    loadContent(document.location.href.replace(/lang=\d+/, `)
//line user.js.qtpl:2
	qw422016.N().S("`")
//line user.js.qtpl:2
	qw422016.N().S(``)
//line user.js.qtpl:2
	qw422016.N().S("`")
//line user.js.qtpl:2
	qw422016.N().S(`));
    return false
}


function saveUser(userData) {
    var userSuffix = userData.lang ? `)
//line user.js.qtpl:2
	qw422016.N().S("`")
//line user.js.qtpl:2
	qw422016.N().S(`(${userData.lang})`)
//line user.js.qtpl:2
	qw422016.N().S("`")
//line user.js.qtpl:2
	qw422016.N().S(` : '';
    console.log(userData);
    token = userData.token || userData.access_token || userData.bearer_token || userData.auth_token;

    $('#sUser').text(userData.name + userSuffix).removeClass('before-login').addClass('after-login');
    $('.after-login').show();
    $('.before-login').hide();
    $('.auth').removeClass("auth");
    changeLang(userData.lang);

    if (userData.theme) {
        // call custom theme changer
        if (typeof CustomChangeTheme !== "undefined") {
            CustomChangeTheme(userData.theme);
        } else {
            // use default
            ChangeTheme(userData.theme);
        }
    }

    if (urlAfterLogin === '') {
        if (urlAfterLogin.onsubmit !== undefined) {
            urlAfterLogin.onsubmit();
            urlAfterLogin = "";
            return;
        } else if (userData.formActions !== undefined) {
            urlAfterLogin = userData.formActions[0].url;
        }
    }
    if (urlAfterLogin > '') {
        loadContent(urlAfterLogin);
    }
}

function ChangeTheme(id_themes) {
    LoadCSS(`)
//line user.js.qtpl:2
	qw422016.N().S("`")
//line user.js.qtpl:2
	qw422016.N().S(`/themes/?id=${id_themes}`)
//line user.js.qtpl:2
	qw422016.N().S("`")
//line user.js.qtpl:2
	qw422016.N().S(`, true, function (data, status, xhr) {
        switch (xhr.status) {
            case 201:
            case 204:
            case 200: {
                let theme = xhr.getResponseHeader('Section-Name');
                LoadStyles(theme, data);
                $('body').attr('theme', theme);
                return
            }
            default:
                console.log(status, data)
        }
    });

    return false
}

function logOut(elem) {
    if (!confirm(`)
//line user.js.qtpl:2
	qw422016.N().S("`")
//line user.js.qtpl:2
	qw422016.N().S(`Do you sure to logout?`)
//line user.js.qtpl:2
	qw422016.N().S("`")
//line user.js.qtpl:2
	qw422016.N().S(`)) {
        return false;
    }
    token = null;
    $('#sUser').text('').removeClass('after-login').addClass('before-login');
    $('.before-login').show();
    $('.after-login').hide();
    $('.auth').addClass("auth");
    localStorage.removeItem("USER");
    loadContent(elem.href);
    return false;
}`)
//line user.js.qtpl:2
	qw422016.N().S(`
`)
//line user.js.qtpl:3
}

//line user.js.qtpl:3
func WriteUserJS(qq422016 qtio422016.Writer) {
//line user.js.qtpl:3
	qw422016 := qt422016.AcquireWriter(qq422016)
//line user.js.qtpl:3
	StreamUserJS(qw422016)
//line user.js.qtpl:3
	qt422016.ReleaseWriter(qw422016)
//line user.js.qtpl:3
}

//line user.js.qtpl:3
func UserJS() string {
//line user.js.qtpl:3
	qb422016 := qt422016.AcquireByteBuffer()
//line user.js.qtpl:3
	WriteUserJS(qb422016)
//line user.js.qtpl:3
	qs422016 := string(qb422016.B)
//line user.js.qtpl:3
	qt422016.ReleaseByteBuffer(qb422016)
//line user.js.qtpl:3
	return qs422016
//line user.js.qtpl:3
}
