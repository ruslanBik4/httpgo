// Code generated by qtc from "observer.js.qtpl". DO NOT EDIT.
// See https://github.com/valyala/quicktemplate for details.

//line observer.js.qtpl:1
package js

//line observer.js.qtpl:1
import (
	qtio422016 "io"

	qt422016 "github.com/valyala/quicktemplate"
)

//line observer.js.qtpl:1
var (
	_ = qtio422016.Copy
	_ = qt422016.AcquireByteBuffer
)

//line observer.js.qtpl:1
func StreamObserver(qw422016 *qt422016.Writer) {
//line observer.js.qtpl:1
	qw422016.N().S(`	`)
//line observer.js.qtpl:2
	qw422016.N().S(`function createObserver() {
// Create a MutationObserver instance
    const observer = new MutationObserver((mutationsList, observer) => {
        console.debug("Attributes changed:", mutationsList);
        for (const mutation of mutationsList) {
            if (mutation.type === "childList") {
                mutation.addedNodes.forEach(node => { processAll(node); } );
            } else if (mutation.type === "attributes") {
                let ignores = ["style", "class", "rel"];
                if (ignores.indexOf(mutation.attributeName) > -1) {
                    return
                }
                console.log("Attributes changed:", mutation);
            } else if (mutation.type === "characterData") {
                console.log("Text content changed:", mutation);
            } else {
                console.error("Attributes not changed:", mutation);
            }
        }
    });

// Configure observer options
    const config = {
        childList: true,      // Detect when children are added/removed
        attributes: true,     // Detect attribute changes
        subtree: true,        // Observe all descendants
        characterData: true   // Detect text content changes
    };

    observer.observe(document.body, config);
    console.debug('observer created')
}

function processAll(parent) {
    console.debug('process');
     console.debug(parent);
    if (parent) {
        SetDatesInputs(parent);
        htmx.process(parent);
        setClickAll(parent);
        return;
    }
    console.error('is empty parent');
}

function cfgHTMX() {
    document.body.addEventListener('htmx:onLoadError', function (evt) {
        console.log(evt);
        handleError(evt.detail.xhr, evt.detail.xhr.status, evt.detail.xhr.error);
    });

    document.body.addEventListener('htmx:configRequest', function (evt) {
        evt.detail.headers['Authorization'] = 'Bearer ' + token;
        evt.detail.headers['Accept-Language'] = lang;
        evt.detail.headers['X-Requested-With'] = 'XMLHttpRequest';
        evt.detail.headers['HX-Request'] = 'html';
        const pathInfo = evt.detail.path;
        if (pathInfo && pathInfo.finalRequestPath) {
            console.log(pathInfo);
            pathInfo.responsePath = replMacros(pathInfo.finalRequestPath);
        } else {
            console.log(evt);
        }
    });

    document.body.addEventListener('htmx:beforeSwap', evt => {
        if (!evt.detail.elt.attributes.target) {
            if (evt.detail.xhr.status === 204) {
                alert('empty response!');
                evt.preventDefault();
            }
            return;
        }
        let responseText = evt.detail.xhr.responseText;
        switch (evt.detail.elt.attributes.target.nodeValue) {
            case "_modal":
                fancyOpen(responseText);

                return false;

            case "_blank":
                var uri = "data:text/html," + encodeURIComponent(responseText);
                var newWindow = window.open('localhost', "Preview");
                newWindow.document.write(responseText);
                newWindow.focus();
                setTimeout(function () {
                    newWindow.setClickAll();
                }, 1000);

                evt.preventDefault();
                return false;
        }
    });

    document.body.addEventListener('htmx:afterRequest', evt => {
        const xhr = evt.detail.xhr;
        switch (xhr.status) {
            case 204:
                evt.preventDefault();
                alert('empty response!');
                return false;
            case 201:
                alert(`)
//line observer.js.qtpl:2
	qw422016.N().S("`")
//line observer.js.qtpl:2
	qw422016.N().S(`Successful add record #${xhr.responseText}`)
//line observer.js.qtpl:2
	qw422016.N().S("`")
//line observer.js.qtpl:2
	qw422016.N().S(`);
            case 200:
                htmx.trigger(evt.detail.target, 'on_change');
                processAll(evt.detail.target);
        }
    });

    document.body.addEventListener('htmx:responseError', evt => {
        const xhr = evt.detail.xhr;
        switch (xhr.status) {
            case 401:
                evt.preventDefault();
                return relogin(xhr.responseURL);
            case 400:
                // stop the regular request from being issued
                evt.preventDefault();
                const src = evt.detail.elt;
                let obj = JSON.parse(xhr.responseText);
                showErrors(obj.formErrors, src)
        }
    });
}

function showErrors(formErrors, thisForm) {
    if (formErrors) {
        let out = $('output', thisForm);
        for (let key in formErrors) {
            let elem = $(`)
//line observer.js.qtpl:2
	qw422016.N().S("`")
//line observer.js.qtpl:2
	qw422016.N().S(`[name=${key}]`)
//line observer.js.qtpl:2
	qw422016.N().S("`")
//line observer.js.qtpl:2
	qw422016.N().S(`, thisForm);
            if (elem.length > 0) {
                elem.nextAll('.errorLabel').show().text(formErrors[key]);
                elem.addClass('error-field').focus();
                if (elem.nextAll('.errorLabel').length === 0) {
                    elem.after(`)
//line observer.js.qtpl:2
	qw422016.N().S("`")
//line observer.js.qtpl:2
	qw422016.N().S(`<h6 class="errorLabel" style="display:flex; font-size: smaller"> ${formErrors[key]} </h6>`)
//line observer.js.qtpl:2
	qw422016.N().S("`")
//line observer.js.qtpl:2
	qw422016.N().S(`);
                }
                elem.parents('details').attr('open', true);
            } else {
                out.text(formErrors[key]);
            }
        }
    }
}
`)
//line observer.js.qtpl:2
	qw422016.N().S(`
`)
//line observer.js.qtpl:3
}

//line observer.js.qtpl:3
func WriteObserver(qq422016 qtio422016.Writer) {
//line observer.js.qtpl:3
	qw422016 := qt422016.AcquireWriter(qq422016)
//line observer.js.qtpl:3
	StreamObserver(qw422016)
//line observer.js.qtpl:3
	qt422016.ReleaseWriter(qw422016)
//line observer.js.qtpl:3
}

//line observer.js.qtpl:3
func Observer() string {
//line observer.js.qtpl:3
	qb422016 := qt422016.AcquireByteBuffer()
//line observer.js.qtpl:3
	WriteObserver(qb422016)
//line observer.js.qtpl:3
	qs422016 := string(qb422016.B)
//line observer.js.qtpl:3
	qt422016.ReleaseByteBuffer(qb422016)
//line observer.js.qtpl:3
	return qs422016
//line observer.js.qtpl:3
}
